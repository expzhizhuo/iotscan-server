import{U as E,_ as $}from"./index-2c25bdbe.js";/* empty css                   *//* empty css               *//* empty css                 */import{T as D}from"./TablesView-b69a0b48.js";import{H as N,_ as T,a as y,l as U,m as q,V as e,P as o,T as d,aA as I,ax as L,A as O,$ as H,b as M,p as w,u as A}from"./vue-657d2c67.js";/* empty css                     *//* empty css                 */import{a as z,w as B,x as j,z as G,A as W,m as F,C as J,b as K,F as Q,H as X}from"./element-deea76d4.js";/* empty css                    */const Y=[{prop:"username",label:"用户名",sortable:!0,showOverflowTooltip:!0},{prop:"phone",label:"手机号",showOverflowTooltip:!0},{prop:"permissions",label:"权限",sortable:!0,slot:"permissions"},{prop:"last_login_ip",label:"最后一次登陆ip",showOverflowTooltip:!0},{prop:"last_login",label:"最后一次登陆时间",width:"180px"},{type:"date",prop:"create_time",label:"创建时间",width:"180px"},{width:"140",label:"操作",buttons:[{name:"删除",type:"danger",icon:"Delete",command:"delete"}]}],Z=N({__name:"CreateUserWindows",props:{dialog:Boolean},emits:["add"],setup(R,{emit:n}){const f=R,l=T({username:"",password:"",password_again:"",email:"",phone:"",permissions:"0"}),u=y(),g=T({username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:8,message:"密码长度大于等于8位",trigger:"blur"}],password_again:[{required:!0,message:"请输入确认密码",trigger:"change"},{min:8,message:"确认密码长度大于等于8位",trigger:"blur"},{validator:(m,t,i)=>{t!==l.password?i(new Error("两次输入的密码不一致")):i()},trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"手机号格式不正确",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"邮箱格式不正确",trigger:"blur"}],permissions:[{required:!0,message:"请选择用户权限",trigger:"blur"}]});f.dialog;const s=y(!1);s.value=f.dialog;const v=m=>E.create_user(m),S=m=>{m&&m.validate((t,i)=>{if(t)v(l).then(p=>{p.data.code==200&&(z.success(p.data.data),s.value=!1,n("add",s.value))});else return!1})},V=()=>{s.value=!1,n("add",s.value)};return(m,t)=>{const i=B,p=j,x=G,k=W,C=F,r=J;return U(),q("div",null,[e(r,{ref_key:"ruleFormRef",ref:u,model:l,"label-width":"140px",rules:g},{default:o(()=>[e(p,{label:"用户名",prop:"username"},{default:o(()=>[e(i,{modelValue:l.username,"onUpdate:modelValue":t[0]||(t[0]=a=>l.username=a),type:"text",placeholder:"请输入用户名",autocomplete:"off",minlength:"8",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(p,{label:"密码",prop:"password"},{default:o(()=>[e(i,{modelValue:l.password,"onUpdate:modelValue":t[1]||(t[1]=a=>l.password=a),type:"password",placeholder:"请输入密码",autocomplete:"off",clearable:"",style:{width:"200px"},"show-password":""},null,8,["modelValue"])]),_:1}),e(p,{label:"确认密码",prop:"password_again"},{default:o(()=>[e(i,{modelValue:l.password_again,"onUpdate:modelValue":t[2]||(t[2]=a=>l.password_again=a),type:"password",placeholder:"请再次输入密码",clearable:"",style:{width:"200px"},"show-password":""},null,8,["modelValue"])]),_:1}),e(p,{label:"手机号",prop:"phone"},{default:o(()=>[e(i,{modelValue:l.phone,"onUpdate:modelValue":t[3]||(t[3]=a=>l.phone=a),type:"text",placeholder:"请输入手机号",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(p,{label:"邮箱",prop:"email"},{default:o(()=>[e(i,{modelValue:l.email,"onUpdate:modelValue":t[4]||(t[4]=a=>l.email=a),type:"text",placeholder:"请输入邮箱",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(p,{label:"用户身份",prop:"permissions"},{default:o(()=>[e(k,{modelValue:l.permissions,"onUpdate:modelValue":t[5]||(t[5]=a=>l.permissions=a)},{default:o(()=>[e(x,{label:"1"},{default:o(()=>[d("管理员")]),_:1}),e(x,{label:"0"},{default:o(()=>[d("普通用户")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(p,null,{default:o(()=>[e(C,{type:"primary",onClick:t[6]||(t[6]=a=>S(u.value))},{default:o(()=>[d("创建")]),_:1}),e(C,{onClick:V},{default:o(()=>[d("取消")]),_:1})]),_:1})]),_:1},8,["model","rules"])])}}}),ee={class:"users_search"},ae={key:0},le={key:1},te=N({__name:"UserView",setup(R){const n=I(),f=L(),l=O("reload"),u=y(),g=y(!1);n.query.search&&(u.value=n.query.search);const s={page:Number(n.query.page)||1,pageSize:Number(n.query.pageSize)||10,search:String(n.query.search)||""},v=T({tableDemoList:[],options:{showPagination:!0}}),{options:S}=H(v),V=y([]),m=(r,a,c)=>{switch(r){case"edit":alert("点击了编辑");break;case"delete":K.confirm(`确认用户${a.username}删除吗？`,"提示").then(()=>{E.delete_user({user_id:a.id}).then(_=>{_.data.code==200?(z.success("删除成功"),l()):z.error("删除失败")})}).catch(()=>null);break}},t=async(r,a,c=s.search)=>{await f.push({path:n.path,query:{page:r,pageSize:a,search:c}}),l()},i=()=>{u.value,u.value?f.push({path:n.path,query:{page:1,pageSize:10,search:u.value}}):(z.error("请输入搜索内容"),l())},p=async()=>{u.value="",await f.replace({path:n.path,query:{page:1,pageSize:10,search:""}}),l()},x=()=>{g.value=!0},k=r=>{g.value=r,r||l()},C=(r=1,a=10,c="")=>E.getUserList({page:r,page_size:a,search:c});return M(()=>n.query,async r=>{const{page:a,pageSize:c,search:_}=r;s.page=Number(a)||s.page,s.pageSize=Number(c)||s.pageSize,s.search=_||"",C(s.page,s.pageSize,s.search).then(b=>{V.value=b.data.data.list,v.options.paginationConfig={total:b.data.data.total,currentPage:s.page,pageSize:s.pageSize,pageSizes:[10,20,50],layout:"total,prev, pager, next,sizes"}})},{immediate:!0}),(r,a)=>{const c=B,_=F,b=X,P=Q;return U(),q("div",null,[w("div",ee,[e(c,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=h=>u.value=h),placeholder:"请输入搜索内容",style:{width:"300px","margin-left":"10px"},clearable:""},null,8,["modelValue"]),e(_,{type:"primary",onClick:i,style:{"margin-left":"30px"}},{default:o(()=>[d("搜索")]),_:1}),e(_,{type:"primary",onClick:p},{default:o(()=>[d("重置")]),_:1}),e(_,{type:"primary",onClick:x},{default:o(()=>[d("创建用户")]),_:1})]),w("div",null,[e(D,{columns:A(Y),"table-data":V.value,options:A(S),onPaginationChange:t,onCommand:m},{permissions:o(({row:h})=>[h.permissions==1?(U(),q("div",ae,[w("span",null,[e(b,{type:"danger"},{default:o(()=>[d("管理员")]),_:1})])])):(U(),q("div",le,[w("span",null,[e(b,{type:"success"},{default:o(()=>[d("普通用户")]),_:1})])]))]),_:1},8,["columns","table-data","options"])]),w("div",null,[e(P,{modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=h=>g.value=h),title:"创建用户"},{default:o(()=>[e(Z,{dialog:g.value,onAdd:k},null,8,["dialog"])]),_:1},8,["modelValue"])])])}}});const ge=$(te,[["__scopeId","data-v-7cc5d450"]]);export{ge as default};
