import{s as E,_ as H}from"./index-2c25bdbe.js";/* empty css                   *//* empty css                    *//* empty css               *//* empty css                 */import{T as te}from"./TablesView-b69a0b48.js";import{H as J,a as b,_ as K,l as T,m as F,V as a,P as l,T as r,S as W,F as le,a8 as se,O as oe,aA as ne,ax as re,A as ue,$ as ie,b as pe,Z as de,p as c,u as Z,U as S,ay as ce,az as _e}from"./vue-657d2c67.js";/* empty css                     *//* empty css                    *//* empty css                 */import{a as _,w as Q,x as me,y as X,z as ge,A as fe,B as ve,m as Y,C as ye,D as be,F as he,b as j,G,H as ke,p as we}from"./element-deea76d4.js";const Ve=[{prop:"desc",label:"任务描述",showOverflowTooltip:!0},{prop:"status",label:"任务状态",slot:"status",sortable:!0,showOverflowTooltip:!0},{prop:"poc_type",label:"POC类型",slot:"poc_type",sortable:!0,showOverflowTooltip:!0},{prop:"scanning_speed",label:"扫描速度",width:"100px",slot:"scanning_speed",showOverflowTooltip:!0},{prop:"progress",label:"扫描进度",slot:"progress",sortable:!0,showOverflowTooltip:!0},{prop:"create_user",label:"创建用户",slot:"create_user"},{prop:"create_time",label:"创建时间",showOverflowTooltip:!0},{width:"240",label:"操作",buttons:[],slot:"action"}],I={get_tasks_list(p){return E({url:"/tasks/tasklist",method:"get",params:p})},create_task(p){return E({url:"/tasks/tasklist/create_task",method:"post",data:p})},delete_tasks(p){return E({url:"/tasks/tasklist/task_delete",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:p})},setting_tasks(p){return E({url:"/tasks/tasklist/task_setting",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:p})}},xe={key:0},Ce={key:1},Te=J({__name:"CreateTasksWindows",props:{dialog:Boolean},emits:["add"],setup(p,{emit:m}){const w=p,x=b(),g=b({value:-1,label:"不使用POC"}),k=b([{value:"-1",label:"不使用POC"},{value:"0",label:"全部"},{value:"1",label:"低危"},{value:"2",label:"中危"},{value:"3",label:"高危"},{value:"4",label:"严重"},{value:"5",label:"特定poc扫描"}]),o=b({host:[],desc:"",scanning_speed:1,is_use_port_scan:!0,port_type:"TOP100",is_use_proxy:!1,is_use_domainscan:!1,domain_type:"SMALL",poc_type:g.value.value,poc_warehouse_ids:[]});w.dialog;const y=b(!1);y.value=w.dialog;const u=b(),A=K({desc:[{required:!0,message:"请输入项目描述",trigger:"blur"}]}),z=f=>{o.value,f&&f.validate((s,C)=>{if(s){const i=q(x.value);i&&(o.value.host=i,U(o.value).then(h=>{h.data.code==200?(_.success("创建成功"),y.value=!1,m("add",y.value)):_.error("创建失败，请检查数据是否有误")}))}else return!1})},R=()=>{y.value=!1,m("add",y.value)},B=f=>{o.value.poc_type=f},U=f=>I.create_task(f),q=f=>{if(!f)return _.error("扫描目标不能为空"),!1;const s=/^(https?:\/\/)?(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\/(3[0-2]|[12]?[0-9]))?(-((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|([0-9]))(\.((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|([0-9]))){0,3})?$/,C=/^(https?:\/\/)?\[((?:[A-Fa-f0-9]{1,4}:){7}(?:[A-Fa-f0-9]{1,4}|:)|(?:[A-Fa-f0-9]{1,4}:){1,6}:(?:[A-Fa-f0-9]{1,4}|:)|(?:[A-Fa-f0-9]{1,4}:){1,5}:(?:[A-Fa-f0-9]{1,4}:){1,2}(?:[A-Fa-f0-9]{1,4}|:)|(?:[A-Fa-f0-9]{1,4}:){1,4}:(?:[A-Fa-f0-9]{1,4}:){1,3}(?:[A-Fa-f0-9]{1,4}|:)|(?:[A-Fa-f0-9]{1,4}:){1,3}:(?:[A-Fa-f0-9]{1,4}:){1,4}(?:[A-Fa-f0-9]{1,4}|:)|(?:[A-Fa-f0-9]{1,4}:){1,2}:(?:[A-Fa-f0-9]{1,4}:){1,5}(?:[A-Fa-f0-9]{1,4}|:)|[A-Fa-f0-9]{1,4}:(?:(?:[A-Fa-f0-9]{1,4}:){1,6}|:)|(?:[A-Fa-f0-9]{1,4}:){1,7}:|:(?::[A-Fa-f0-9]{1,4}){1,7}|:)\](\/\d{1,3})?$/,i=/^(https?:\/\/)?((\d{1,3}\.){3}\d{1,3}|[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*)(:\d+)?(\/.*)?$/,h=f.split(/[\n;]/).filter(Boolean);for(let d of h)if(!s.test(d)&&!C.test(d)&&!i.test(d))return _.error(`请输入有效的IPv4、IPv6地址或域名${d}`),!1;return h};return(f,s)=>{const C=Q,i=me,h=X,d=ge,P=fe,L=be,N=ve,$=Y,t=ye;return T(),F("div",null,[a(t,{model:o.value,"label-width":"140px",rules:A,ref_key:"ruleFormRef",ref:u},{default:l(()=>[a(i,{label:"任务描述",prop:"desc"},{default:l(()=>[a(C,{modelValue:o.value.desc,"onUpdate:modelValue":s[0]||(s[0]=e=>o.value.desc=e),placeholder:"请输入任务描述",clearable:""},null,8,["modelValue"])]),_:1}),a(i,{label:"端口扫描"},{default:l(()=>[a(h,{modelValue:o.value.is_use_port_scan,"onUpdate:modelValue":s[1]||(s[1]=e=>o.value.is_use_port_scan=e)},null,8,["modelValue"])]),_:1}),o.value.is_use_port_scan==!0?(T(),F("div",xe,[a(i,{label:"端口类型"},{default:l(()=>[a(P,{modelValue:o.value.port_type,"onUpdate:modelValue":s[2]||(s[2]=e=>o.value.port_type=e)},{default:l(()=>[a(d,{label:"ALL"},{default:l(()=>[r("全部端口")]),_:1}),a(d,{label:"TOP1000"},{default:l(()=>[r("TOP1000端口")]),_:1}),a(d,{label:"TOP100"},{default:l(()=>[r("TOP100端口")]),_:1}),a(d,{label:"TOP10"},{default:l(()=>[r("TOP10端口")]),_:1})]),_:1},8,["modelValue"])]),_:1})])):W("",!0),a(i,{label:"子域名扫描"},{default:l(()=>[a(h,{modelValue:o.value.is_use_domainscan,"onUpdate:modelValue":s[3]||(s[3]=e=>o.value.is_use_domainscan=e)},null,8,["modelValue"])]),_:1}),o.value.is_use_domainscan==!0?(T(),F("div",Ce,[a(i,{label:"子域名字典"},{default:l(()=>[a(P,{modelValue:o.value.domain_type,"onUpdate:modelValue":s[4]||(s[4]=e=>o.value.domain_type=e)},{default:l(()=>[a(d,{label:"ALL"},{default:l(()=>[r("全量字典")]),_:1}),a(d,{label:"SMALL"},{default:l(()=>[r("默认字典")]),_:1})]),_:1},8,["modelValue"])]),_:1})])):W("",!0),a(i,{label:"启用代理"},{default:l(()=>[a(h,{modelValue:o.value.is_use_proxy,"onUpdate:modelValue":s[5]||(s[5]=e=>o.value.is_use_proxy=e)},null,8,["modelValue"])]),_:1}),a(i,{label:"漏洞类型"},{default:l(()=>[a(N,{placeholder:"请选择类型",modelValue:g.value.label,"onUpdate:modelValue":s[6]||(s[6]=e=>g.value.label=e)},{default:l(()=>[(T(!0),F(le,null,se(k.value,e=>(T(),oe(L,{key:e.value,label:e.label,value:e.value,onClick:v=>B(e.value)},null,8,["label","value","onClick"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"目标"},{default:l(()=>[a(C,{modelValue:x.value,"onUpdate:modelValue":s[7]||(s[7]=e=>x.value=e),type:"textarea",autosize:{minRows:4,maxRows:4},placeholder:"请输入IPv4、IPv6地址或域名，可使用换行或分号分隔"},null,8,["modelValue"])]),_:1}),a(i,null,{default:l(()=>[a($,{size:"large",round:"",type:"primary",onClick:s[8]||(s[8]=e=>z(u.value))},{default:l(()=>[r("创建")]),_:1}),a($,{size:"large",round:"",onClick:R},{default:l(()=>[r("取消")]),_:1})]),_:1})]),_:1},8,["model","rules"])])}}});const Ae=H(Te,[["__scopeId","data-v-387802c4"]]),ze=p=>(ce("data-v-2a14b598"),p=p(),_e(),p),Se={class:"poc_search"},Fe={style:{"margin-left":"auto","margin-right":"30px"}},Pe=ze(()=>c("span",{style:{"font-size":"10px","margin-top":"12px","margin-left":"10px"}}," 每3秒刷新一次 ",-1)),$e={class:"percentage-value"},Oe=J({__name:"TasksView",setup(p){const m=ne(),w=re(),x=b(!1),g=ue("reload"),k=b(),o=b([]),y=b(!1);m.query.search&&(k.value=m.query.search);const u={page:Number(m.query.page)||1,pageSize:Number(m.query.pageSize)||10,search:String(m.query.search)||""},A=K({options:{showPagination:!0}}),z=b([]),{options:R}=ie(A),B=async(t,e,v=u.search)=>{await w.push({path:m.path,query:{page:t,pageSize:e,search:v}}),g()},U=()=>{k.value,k.value?w.push({path:m.path,query:{page:1,pageSize:10,search:k.value}}):(_.error("请输入搜索内容"),g())},q=t=>{t.id,j.confirm("是否停止此任务？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const e=G.service({lock:!0,text:`正在停止${t.desc}任务，请忽刷新或关闭页面，请耐心等待。`,background:"rgba(0, 0, 0, 0.7)"});I.setting_tasks({task_ids:t.id,task_status:2}).then(v=>{v.data.code==200?_.success(`停止任务${t.id}成功`):_.error(`停止任务${t.id}失败`),e.close(),g()})}).catch(()=>{_({type:"info",message:"取消操作"}),g()})},f=async()=>{k.value="",await w.push({path:m.path,query:{page:1,pageSize:10,search:""}}),g()},s=t=>{t.id,j.confirm("是否删除此任务？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{if(t.status==1||t.status==0){_.error("请停止任务后在删除此任务");return}const e=G.service({lock:!0,text:`正在删除${t.desc}任务，请忽刷新或关闭页面，请耐心等待。`,background:"rgba(0, 0, 0, 0.7)"});I.delete_tasks({tasks_id:t.id}).then(v=>{v.data.code==200?_.success(`删除任务${t.id}成功`):_.error(`删除任务${t.id}失败`),e.close(),g()})}).catch(()=>{_({type:"info",message:"取消删除"}),g()})},C=t=>{w.push({path:"/project/info",query:{task_ids:t.id}})},i=()=>{y.value=!0},h=t=>{y.value=t,t||g()},d=(t=1,e=10,v="")=>I.get_tasks_list({page:t,page_size:e,search:v});pe(()=>m.query,async t=>{const{page:e,pageSize:v,search:V}=t;u.page=Number(e)||u.page,u.pageSize=Number(v)||u.pageSize,u.search=V||"",d(u.page,u.pageSize,u.search).then(O=>{z.value=O.data.data.list,A.options.paginationConfig={total:O.data.data.total,currentPage:u.page,pageSize:u.pageSize,pageSizes:[10,50,100,1e3],layout:"total,prev, pager, next,sizes"}})},{immediate:!0});const P=()=>{if(x.value){const t=setInterval(()=>{d().then(e=>{e.data.code==200?(z.value=e.data.data.list,A.options.paginationConfig={total:e.data.data.total,currentPage:u.page=1,pageSize:u.pageSize=10,pageSizes:[10,50,100,1e3],layout:"total,prev, pager, next,sizes"}):(_.error(e.data.msg||"服务器异常"),w.push("/login"))})},3e3);o.value.push(t)}else for(const t of o.value)clearInterval(t)};de(()=>{for(const t of o.value)clearInterval(t)});const L=t=>({"-1":"停止",0:"初始化",1:"运行中",2:"完成",3:"删除",4:"失败",5:"未知错误"})[t],N=t=>({0:"全部",1:"低危",2:"中危",3:"高危",4:"严重",5:"特定poc扫描","-1":"不使用poc"})[t],$=t=>({0:"低速",1:"默认",2:"高速"})[t];return(t,e)=>{const v=Q,V=Y,O=X,D=ke,ee=we,ae=he;return T(),F("div",null,[c("div",null,[c("div",Se,[a(v,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=n=>k.value=n),placeholder:"请输入搜索内容",style:{width:"300px","margin-left":"10px"},clearable:""},null,8,["modelValue"]),a(V,{size:"large",round:"",type:"primary",onClick:U,style:{"margin-left":"30px"}},{default:l(()=>[r("搜索 ")]),_:1}),a(V,{size:"large",round:"",type:"primary",onClick:f},{default:l(()=>[r("重置")]),_:1}),a(V,{size:"large",round:"",type:"primary",onClick:i},{default:l(()=>[r("创建任务")]),_:1}),c("div",Fe,[c("span",null,[r(" 开启自动刷新 "),a(O,{modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=n=>x.value=n),size:"large",onClick:P},null,8,["modelValue"])]),Pe])]),c("div",null,[a(te,{columns:Z(Ve),"table-data":z.value,options:Z(R),onPaginationChange:B},{status:l(({row:n})=>[c("span",null,[a(D,{type:{"-1":"danger",0:"info",1:"",2:"success",3:"danger",4:"danger",5:"warning"}[n.status]},{default:l(()=>[r(S(L(n.status)),1)]),_:2},1032,["type"])])]),poc_type:l(({row:n})=>[c("span",null,[a(D,{type:{0:"",1:"success",2:"warning",3:"danger",4:"danger",5:"info","-1":"danger"}[n.poc_type]},{default:l(()=>[r(S(N(n.poc_type)),1)]),_:2},1032,["type"])])]),scanning_speed:l(({row:n})=>[c("span",null,[a(D,{type:{0:"",1:"info",2:"danger"}[n.scanning_speed]},{default:l(()=>[r(S($(n.scanning_speed)),1)]),_:2},1032,["type"])])]),progress:l(({row:n})=>[c("span",null,[a(ee,{type:"circle",percentage:n.progress,width:40,"stroke-width":2},{default:l(()=>[c("span",$e,S(n.progress)+"%",1)]),_:2},1032,["percentage"])])]),create_user:l(({row:n})=>[c("span",null,S(n.create_user.username),1)]),action:l(({row:n})=>[c("div",null,[a(V,{onClick:M=>q(n)},{default:l(()=>[r("停止")]),_:2},1032,["onClick"]),a(V,{type:"danger",onClick:M=>s(n)},{default:l(()=>[r("删除")]),_:2},1032,["onClick"]),a(V,{type:"primary",onClick:M=>C(n)},{default:l(()=>[r("查看")]),_:2},1032,["onClick"])])]),_:1},8,["columns","table-data","options"])])]),c("div",null,[a(ae,{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=n=>y.value=n),title:"创建扫描任务"},{default:l(()=>[a(Ae,{dialog:y.value,onAdd:h},null,8,["dialog"])]),_:1},8,["modelValue"])])])}}});const Ze=H(Oe,[["__scopeId","data-v-2a14b598"]]);export{Ze as default};
